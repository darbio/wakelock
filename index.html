<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Wake Lock Demo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
      background: #f9f9f9;
      color: #333;
    }
    h1 {
      color: #333;
    }
    #status {
      font-weight: bold;
      color: green;
    }
    #status.inactive {
      color: red;
    }
    button {
      padding: 1rem 2rem;
      font-size: 1rem;
      margin-top: 1rem;
      cursor: pointer;
    }
    .explanation {
      margin-top: 2rem;
      max-width: 700px;
    }
    pre {
      background: #eee;
      padding: 1rem;
      overflow-x: auto;
    }
    code {
      font-family: monospace;
    }
    footer {
      margin-top: 3rem;
      font-size: 0.9rem;
      color: #555;
    }
    video {
      display: none;
    }
  </style>
</head>
<body>
  <h1>Wake Lock Demo</h1>

  <p>Status: <span id="status" class="inactive">Inactive</span></p>
  <button id="toggleBtn">Enable Wake Lock</button>

  <!-- Hidden video fallback for Safari -->
  <video id="fallbackVideo" loop muted playsinline>
    <source src="https://file-examples.com/wp-content/storage/2017/04/file_example_MP4_480_1_5MG.mp4" type="video/mp4">
  </video>

  <div class="explanation">
    <h2>What is Wake Lock?</h2>
    <p>
      This page demonstrates the 
      <a href="https://developer.mozilla.org/en-US/docs/Web/API/Screen_Wake_Lock_API" target="_blank">Screen Wake Lock API</a>,
      which keeps your screen awake while this page is open. On Safari, it uses a small hidden video to achieve the same effect.
    </p>

    <h2>How it works</h2>
    <p>
      When you click <strong>Enable Wake Lock</strong>, this page either uses the official API or plays a hidden looping video to prevent the screen from dimming.
    </p>

    <h3>Key points:</h3>
    <ul>
      <li>✅ Uses the standard <code>navigator.wakeLock</code> API if supported.</li>
      <li>✅ Falls back to a muted hidden video on Safari and unsupported browsers.</li>
      <li>✅ No personal data is collected or sent.</li>
      <li>✅ Full source: <a href="https://github.com/darbio/wakelock" target="_blank">GitHub Repo</a></li>
    </ul>

    <h3>Example code:</h3>
    <pre><code>
if ('wakeLock' in navigator) {
  await navigator.wakeLock.request('screen');
} else {
  // Fallback: play hidden looping video
  fallbackVideo.play();
}
    </code></pre>
  </div>

  <footer>
    <p><strong>Privacy:</strong> This page does not track you, collect analytics, or store any data. It only uses your device’s browser to keep the screen awake.</p>
    <p>Source code: <a href="https://github.com/darbio/wakelock" target="_blank">View on GitHub</a></p>
    <p>Hosted at <a href="https://wakelock.darb.io" target="_blank">wakelock.darb.io</a></p>
  </footer>

  <script>
    let wakeLock = null;
    const statusEl = document.getElementById('status');
    const toggleBtn = document.getElementById('toggleBtn');
    const fallbackVideo = document.getElementById('fallbackVideo');

    async function requestWakeLock() {
      try {
        if ('wakeLock' in navigator) {
          wakeLock = await navigator.wakeLock.request('screen');
          console.log('Wake Lock is active.');
          wakeLock.addEventListener('release', () => {
            console.log('Wake Lock released.');
            wakeLock = null;
            updateStatus(false);
          });
        } else {
          // Safari fallback: play hidden video
          await fallbackVideo.play();
          console.log('Fallback video playing to keep screen awake.');
        }
        updateStatus(true);
      } catch (err) {
        console.error(`${err.name}, ${err.message}`);
      }
    }

    async function releaseWakeLock() {
      if (wakeLock !== null) {
        await wakeLock.release();
        wakeLock = null;
        console.log('Wake Lock released manually.');
      } else {
        // Safari fallback: pause video
        fallbackVideo.pause();
        fallbackVideo.currentTime = 0;
        console.log('Fallback video paused.');
      }
      updateStatus(false);
    }

    function updateStatus(active) {
      if (active) {
        statusEl.textContent = 'Active';
        statusEl.classList.remove('inactive');
        toggleBtn.textContent = 'Disable Wake Lock';
      } else {
        statusEl.textContent = 'Inactive';
        statusEl.classList.add('inactive');
        toggleBtn.textContent = 'Enable Wake Lock';
      }
    }

    toggleBtn.addEventListener('click', () => {
      if (wakeLock === null && fallbackVideo.paused) {
        requestWakeLock();
      } else {
        releaseWakeLock();
      }
    });

    document.addEventListener('visibilitychange', () => {
      if (document.visibilityState === 'visible') {
        if (wakeLock === null && !fallbackVideo.paused && toggleBtn.textContent === 'Disable Wake Lock') {
          fallbackVideo.play();
        }
        if (wakeLock === null && toggleBtn.textContent === 'Disable Wake Lock') {
          requestWakeLock();
        }
      }
    });
  </script>
</body>
</html>